<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sepet Â· InflowAI</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="page-header-simple">
  <h1>Sepetim</h1>
</header>

<main class="page-main container-narrow">
  <div id="cartBox">YÃ¼kleniyor...</div>

  <button id="checkoutBtn" class="btn primary">SipariÅŸi Tamamla</button>
</main>

<nav class="app-tabbar">
  <a href="index.html" class="tab-item">ğŸ  Anasayfa</a>
  <a href="sepet.html" class="tab-item active">ğŸ›’ Sepet</a>
  <a href="hesabim.html" class="tab-item">ğŸ‘¤ HesabÄ±m</a>
</nav>

<script>
  const API = "https://inflowai-api.onrender.com/api";
  const token = localStorage.getItem("token");

  if (!token) {
    alert("GiriÅŸ yapmalÄ±sÄ±nÄ±z.");
    window.location.href = "hesabim.html";
  }

  async function loadCart() {
    const box = document.getElementById("cartBox");

    const res = await fetch(API + "/cart", {
      headers: { Authorization: "Bearer " + token }
    });

    const data = await res.json();

    if (!res.ok) {
      box.textContent = "Sepet yÃ¼klenemedi.";
      return;
    }

    if (data.items.length === 0) {
      box.textContent = "Sepetiniz boÅŸ.";
      return;
    }

    let html = "";
    let total = 0;

    data.items.forEach(i => {
      html += `
        <div class="cart-row">
          <div>ÃœrÃ¼n: ${i.productId}</div>
          <div>Adet: ${i.quantity}</div>
          <div>Fiyat: ${i.price}â‚º</div>
        </div>
      `;
      total += i.price * i.quantity;
    });

    html += `<h3>Toplam: ${total}â‚º</h3>`;
    box.innerHTML = html;
  }

  document.getElementById("checkoutBtn").onclick = async () => {
    const res = await fetch(API + "/orders", {
      method: "POST",
      headers: {
        Authorization: "Bearer " + token,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ items: [] }) // Sepet API service'den Ã§ekiliyor
    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.message || "SipariÅŸ oluÅŸturulamadÄ±");
      return;
    }

    alert("SipariÅŸ oluÅŸturuldu!");
    window.location.href = "hesabim.html";
  };

  loadCart();
</script>

</body>
</html>
