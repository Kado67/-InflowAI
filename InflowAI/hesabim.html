<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>HesabÄ±m Â· Inflow Market</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header class="page-header-simple">HesabÄ±m</header>

<main class="page-main container-narrow" id="accountArea">YÃ¼kleniyor...</main>

<nav class="app-tabbar">
  <a href="index.html"><span>ğŸ </span>Anasayfa</a>
  <a href="sepet.html"><span>ğŸ›’</span>Sepet</a>
  <a href="hesabim.html" class="active"><span>ğŸ‘¤</span>HesabÄ±m</a>
</nav>

<script src="app.js"></script>
<script>
const API_URL = "https://inflowai-api.onrender.com/api";
const area = document.getElementById("accountArea");
const user = getUser();
const token = getToken();

// Sepetten geldiyse ÅŸÄ±k uyarÄ± kartÄ± gÃ¶stermek iÃ§in
const params = new URLSearchParams(location.search);
const fromCart = params.get("msg") === "login-required";

function renderLoggedOut() {
  const extraMsg = fromCart
    ? `<div class="info-card" style="margin-bottom:12px; border-left:4px solid #f27a1a">
         Bu iÅŸlemi tamamlamak iÃ§in Ã¶nce giriÅŸ yapmanÄ±z gerekiyor.
       </div>`
    : "";

  area.innerHTML = extraMsg + `
    <div class="account-card">
      <h3>GiriÅŸ Yap</h3>
      <div class="form-row">
        <label>Eâ€‘posta</label>
        <input id="email" type="email">
      </div>
      <div class="form-row">
        <label>Åifre</label>
        <input id="password" type="password">
      </div>
      <button class="btn primary" onclick="login()">GiriÅŸ Yap</button>

      <p style="margin-top:6px;">
        <a href="forgot_password.html">Åifremi Unuttum</a>
      </p>

      <p style="margin-top:8px;">
        MÃ¼ÅŸteri hesabÄ± aÃ§mak iÃ§in
        <a href="musteri_register.html">Yeni Ãœyelik</a>
      </p>

      <p style="margin-top:4px;font-size:13px;">
        TedarikÃ§i misiniz?
        <a href="vendor_register.html">MaÄŸaza AÃ§</a> Â·
        <a href="supplier_login.html">MaÄŸaza GiriÅŸi</a>
      </p>
    </div>`;
}

function renderLoggedIn(u) {
  area.innerHTML = `
    <div class="account-card">
      <h3>Merhaba, ${u.name}</h3>
      <p>${u.email}</p>
      <div class="account-actions">
        <a href="siparislerim.html">SipariÅŸlerim</a>
        <a href="favoriler.html">Favorilerim</a>
      </div>
      <br>
      <button class="btn secondary" onclick="logout()">Ã‡Ä±kÄ±ÅŸ Yap</button>
    </div>`;
}

async function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const res = await fetch(API_URL + "/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  });
  const data = await res.json();
  if (!res.ok) {
    alert(data.message || "GiriÅŸ hatasÄ±");
    return;
  }
  localStorage.setItem("token", data.accessToken);
  localStorage.setItem("user", JSON.stringify(data.user));
  location.reload();
}

if (!token || !user) renderLoggedOut();
else renderLoggedIn(user);
</script>
</body>
</html>
